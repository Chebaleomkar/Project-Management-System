# Task Comments Feature Documentation

*January 13, 2026*

## Overview

The **Task Comments** feature adds lightweight discussion capability to tasks. Each comment is linked to a specific task, stores the comment text, the author’s email, and a timestamp.

## Data Model

```python
class TaskComment(models.Model):
    task = models.ForeignKey(
        Task,
        on_delete=models.CASCADE,
        related_name='comments'
    )
    content = models.TextField()
    author_email = models.EmailField()
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['created_at']
```

- **`related_name='comments'`** – Enables `task.comments.all()` and nested GraphQL queries.
- **`ordering`** – Guarantees comments are returned chronologically.
- **Cascade delete** – Removing a task automatically removes its comments.

## Admin

```python
@admin.register(TaskComment)
class TaskCommentAdmin(admin.ModelAdmin):
    list_display = ('id', 'task', 'author_email', 'created_at')
    search_fields = ('author_email', 'content')
    list_filter = ('created_at',)
```

## GraphQL API

### Types

```python
class TaskCommentType(DjangoObjectType):
    class Meta:
        model = TaskComment
        fields = ("id", "task", "content", "author_email", "created_at")
```

The `TaskType` now includes a `comments` field:

```python
class TaskType(DjangoObjectType):
    comments = graphene.List(lambda: TaskCommentType)
    class Meta:
        model = Task
        fields = (..., "comments")
    def resolve_comments(self, info):
        return self.comments.all()
```

### Queries

| Query | Arguments | Returns |
|-------|-----------|---------|
| `commentsByTask` | `taskId!` | List of `TaskCommentType` ordered by `created_at` |

### Mutations

| Mutation | Arguments | Returns |
|----------|-----------|---------|
| `addComment` | `taskId!`, `content!`, `authorEmail!` | `TaskCommentType`, success flag, message |

## Usage Examples (Postman / GraphiQL)

### Add a Comment
```json
{
    "query": "mutation { addComment(taskId: 1, content: \"Looks good!\", authorEmail: \"dev@acme.com\") { success message comment { id content authorEmail createdAt } } }"
}
```

### Get All Comments for a Task
```json
{
    "query": "{ commentsByTask(taskId: 1) { id content authorEmail createdAt } }"
}
```

### Fetch a Task with its Comments
```json
{
    "query": "{ task(id: 1) { title status comments { id content authorEmail createdAt } } }"
}
```

## Design Decisions & Trade‑offs

- **No authentication** – The feature is intentionally simple; later we’ll add JWT‑based user identity.
- **Email as author identifier** – Avoids a full User model while still providing traceability.
- **Separate app (`task_comments`)** – Keeps comment logic isolated, making future extensions (e.g., reactions, attachments) easier.
- **Ordering in `Meta`** – Guarantees deterministic comment order without extra client‑side sorting.

## Future Enhancements
- Attachments (files, images)
- Threaded replies (parent comment FK)
- Permissions (only assignee or organization members can comment)
- Real‑time updates via subscriptions (GraphQL‑WS)

---

*Generated by Antigravity – your AI‑powered coding assistant.*
